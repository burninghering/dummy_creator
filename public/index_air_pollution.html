<!DOCTYPE html>
<html>
<head>
  <title>Vessel Simulation with Leaflet</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    // Leaflet 지도 설정
    const map = L.map('map').setView([35.989426, 129.558305], 13)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map)

    // 오염 구역 폴리곤 추가
    const pollutionPolygon = L.polygon([
      [35.989293, 129.555228],
      [35.988844, 129.555789],
      [35.988255, 129.555151],
      [35.988672, 129.554428]
    ], {
      color: 'red',
      fillOpacity: 0.5
    }).addTo(map)

    // Socket.io 클라이언트 연결
    const socket = io()

    // 선박 마커 관리 객체
    const vesselMarkers = {}

    // 선박 데이터 수신 시 처리
    socket.on('vesselData', (data) => {
      const { id, lati, longi, pollutionIndex } = data

      // 기존 마커가 있으면 업데이트, 없으면 새로 생성
      if (vesselMarkers[id]) {
        vesselMarkers[id].setLatLng([lati, longi])
      } else {
        const marker = L.circleMarker([lati, longi], {
          radius: 5,
          color: pollutionIndex > 50 ? 'red' : 'blue'
        }).addTo(map)
        vesselMarkers[id] = marker
      }
    })
  </script>
</body>
</html>